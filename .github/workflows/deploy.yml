name: Deploy to BunnyCDN
on: 
  push:
    branches: [ main ]
    # Strategy: "Zero-Resource Deployment"
    # 1. User builds locally (npm run build)
    # 2. User pushes 'dist/' folder to git
    # 3. This workflow simply uploads 'dist/' to BunnyCDN (no build step here)
  workflow_dispatch:
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Upload to BunnyCDN
        uses: ayeressian/bunnycdn-storage-deploy@v2.2.5
        with:
          source: "dist" 
          storageZoneName: "bunny-bulk-store1-sydney"
          storageEndpoint: "syd.storage.bunnycdn.com"
          storagePassword: "${{ secrets.BUNNY_STORAGE_PASSWORD }}"
          accessKey: "${{ secrets.BUNNY_ACCESS_KEY }}"
          upload: "true"
      
      - name: Purge Cache
        run: |
            curl --request POST \
            --url https://api.bunny.net/pullzone/5179972/purgeCache \
            --header 'AccessKey: ${{ secrets.BUNNY_ACCESS_KEY }}'
